<div class="profile-container">
  <div class="nav-buttons">
    <button mat-raised-button color="accent" routerLink="/movies">
      Back to the Movies list
    </button>
    <button mat-raised-button color="accent" (click)="logout()">
      Logout
    </button>
  </div>

  <h2>User Profile</h2>

  <mat-card class="profile-card">
    <mat-card-header>
      <mat-card-title>Your personal information</mat-card-title>
    </mat-card-header>
    <mat-card-content>

      <!-- Username -->
      <div>
        <strong>Username:</strong>
        <ng-container *ngIf="editingField !== 'Username'; else editUsername">
          {{ user.Username }}
          <button mat-icon-button (click)="startEdit('Username')">
            <mat-icon>edit</mat-icon>
          </button>
        </ng-container>
        <ng-template #editUsername>
          <form (ngSubmit)="saveEdit('Username')">
            <mat-form-field>
              <input matInput [(ngModel)]="tempValue" name="usernameInput" required />
            </mat-form-field>
            <button mat-icon-button type="submit" style="color: #4CAF50;">
              <mat-icon>check</mat-icon>
            </button>
            <button mat-icon-button color="warn" (click)="cancelEdit()">
              <mat-icon>close</mat-icon>
            </button>
          </form>
        </ng-template>
      </div>

      <!-- Email -->
      <div>
        <strong>Email:</strong>
        <ng-container *ngIf="editingField !== 'Email'; else editEmail">
          {{ user.Email }}
          <button mat-icon-button (click)="startEdit('Email')">
            <mat-icon>edit</mat-icon>
          </button>
        </ng-container>
        <ng-template #editEmail>
          <form (ngSubmit)="saveEdit('Email')">
            <mat-form-field>
              <input matInput [(ngModel)]="tempValue" name="emailInput" type="email" required />
            </mat-form-field>
            <button mat-icon-button type="submit" style="color: #4CAF50;">
              <mat-icon>check</mat-icon>
            </button>
            <button mat-icon-button color="warn" (click)="cancelEdit()">
              <mat-icon>close</mat-icon>
            </button>
          </form>
        </ng-template>
      </div>

      <!-- Birthday -->
      <div>
        <strong>Birthday:</strong>
        <ng-container *ngIf="editingField !== 'Birthday'; else editBirthday">
          {{ user.Birthday }}
          <button mat-icon-button (click)="startEdit('Birthday')">
            <mat-icon>edit</mat-icon>
          </button>
        </ng-container>
        <ng-template #editBirthday>
          <form (ngSubmit)="saveEdit('BirthdayI')">
            <mat-form-field>
              <input matInput [(ngModel)]="tempValue" name="birthdayInput" type="date" required />
            </mat-form-field>
            <button mat-icon-button type="submit" style="color: #4CAF50;">
              <mat-icon>check</mat-icon>
            </button>
            <button mat-icon-button color="warn" (click)="cancelEdit()">
              <mat-icon>close</mat-icon>
            </button>
          </form>
        </ng-template>
      </div>

      <!-- Password -->
      <div>
        <strong>Password:</strong>
        <ng-container *ngIf="editingField !== 'Password'; else editPassword">
          ********
          <button mat-icon-button (click)="startEdit('Password')">
            <mat-icon>edit</mat-icon>
          </button>
        </ng-container>
        <ng-template #editPassword>
          <form (ngSubmit)="saveEdit('Password')">
            <mat-form-field>
              <input matInput [(ngModel)]="currentPassword" name="currentPassword" type="password" placeholder="Current password" required />
            </mat-form-field>
            <mat-form-field>
              <input matInput [(ngModel)]="newPassword" name="newPassword" type="password" placeholder="New password" required />
            </mat-form-field>
            <button mat-icon-button type="submit" style="color: #4CAF50;">
              <mat-icon>check</mat-icon>
            </button>
            <button mat-icon-button color="warn" (click)="cancelEdit()">
              <mat-icon>close</mat-icon>
            </button>
          </form>
        </ng-template>
      </div>

    </mat-card-content>
  </mat-card>

  <!-- Favorite movies card remains unchanged -->
  <mat-card class="favorites-card">
    <mat-card-header>
      <mat-card-title>Your Favorite Movies</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <div class="favorites-grid">
        <mat-card *ngFor="let movie of favoriteMovies" class="movie-card mat-elevation-z4">

          <mat-card-header class="movie-header">
            <mat-card-title>{{ movie.title }}</mat-card-title>
            <mat-card-subtitle>Directed by: {{ movie.director.name }}</mat-card-subtitle>
          </mat-card-header>

          <img mat-card-image [src]="movie.imagePath" alt="{{ movie.title }}" />

          <mat-card-actions style="display: flex; justify-content: space-between; align-items: center;">
            <div style="flex: 1; text-align: center;">
              <button mat-button color="white" (click)="openSynopsisDialog(movie)">
                Synopsis
              </button>
            </div>
            <div style="flex: 0;">
              <button mat-icon-button color="accent" (click)="removeFavorite(movie._id)">
                <mat-icon>delete</mat-icon>
              </button>
            </div>
          </mat-card-actions>
        </mat-card>
      </div>
    </mat-card-content>
  </mat-card>
</div>
